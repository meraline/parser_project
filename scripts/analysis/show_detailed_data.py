#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–∫–∞–∑–∞ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã PostgreSQL
"""

import asyncio
import asyncpg

async def show_detailed_data():
    """–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã"""
    try:
        conn = await asyncpg.connect(
            host='localhost',
            port=5432,
            database='auto_reviews',
            user='parser',
            password='parser'
        )
        
        print("üìã –î–ï–¢–ê–õ–¨–ù–´–ô –ü–†–û–°–ú–û–¢–† –î–ê–ù–ù–´–•")
        print("=" * 60)
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±—Ä–µ–Ω–¥—ã
        print("\nüè¢ –ë–†–ï–ù–î–´:")
        print("-" * 40)
        brands = await conn.fetch("""
            SELECT —ñ–¥, –Ω–∞–∑–≤–∞–Ω–∏–µ, –Ω–∞–∑–≤–∞–Ω–∏–µ_–≤_url, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–æ—Ç–∑—ã–≤–æ–≤
            FROM auto_reviews.–±—Ä–µ–Ω–¥—ã
            ORDER BY –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–æ—Ç–∑—ã–≤–æ–≤ DESC NULLS LAST
        """)
        
        for brand in brands:
            print(f"  ID {brand['—ñ–¥']:2}: {brand['–Ω–∞–∑–≤–∞–Ω–∏–µ']:15} | URL: {brand['–Ω–∞–∑–≤–∞–Ω–∏–µ_–≤_url'] or 'None':15} | –û—Ç–∑—ã–≤–æ–≤: {brand['–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–æ—Ç–∑—ã–≤–æ–≤'] or 0}")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–µ–ª–∏
        print("\nüöó –ú–û–î–ï–õ–ò:")
        print("-" * 40)
        models = await conn.fetch("""
            SELECT m.—ñ–¥, b.–Ω–∞–∑–≤–∞–Ω–∏–µ as –±—Ä–µ–Ω–¥, m.–Ω–∞–∑–≤–∞–Ω–∏–µ, m.–Ω–∞–∑–≤–∞–Ω–∏–µ_–≤_url, m.–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–æ—Ç–∑—ã–≤–æ–≤
            FROM auto_reviews.–º–æ–¥–µ–ª–∏ m
            JOIN auto_reviews.–±—Ä–µ–Ω–¥—ã b ON m.—ñ–¥_–±—Ä–µ–Ω–¥–∞ = b.—ñ–¥
            ORDER BY b.–Ω–∞–∑–≤–∞–Ω–∏–µ, m.–Ω–∞–∑–≤–∞–Ω–∏–µ
        """)
        
        for model in models:
            print(f"  ID {model['—ñ–¥']:2}: {model['–±—Ä–µ–Ω–¥']:10} {model['–Ω–∞–∑–≤–∞–Ω–∏–µ']:20} | URL: {model['–Ω–∞–∑–≤–∞–Ω–∏–µ_–≤_url'] or 'None':15} | –û—Ç–∑—ã–≤–æ–≤: {model['–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–æ—Ç–∑—ã–≤–æ–≤'] or 0}")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–∑—ã–≤—ã
        print("\nüìù –ö–û–†–û–¢–ö–ò–ï –û–¢–ó–´–í–´:")
        print("-" * 40)
        short_reviews = await conn.fetch("""
            SELECT sr.—ñ–¥, b.–Ω–∞–∑–≤–∞–Ω–∏–µ as –±—Ä–µ–Ω–¥, m.–Ω–∞–∑–≤–∞–Ω–∏–µ as –º–æ–¥–µ–ª—å, 
                   sr.–≥–æ–¥_–∞–≤—Ç–æ–º–æ–±–∏–ª—è, sr.–æ–±—ä–µ–º_–¥–≤–∏–≥–∞—Ç–µ–ª—è, sr.—Ç–∏–ø_—Ç–æ–ø–ª–∏–≤–∞,
                   sr.–≥–æ—Ä–æ–¥_–∞–≤—Ç–æ—Ä–∞, sr.–¥–∞—Ç–∞_–ø—É–±–ª–∏–∫–∞—Ü–∏–∏,
                   SUBSTRING(sr.–ø–ª—é—Å—ã, 1, 50) as –ø–ª—é—Å—ã_–∫–æ—Ä–æ—Ç–∫–∏–µ
            FROM auto_reviews.–∫–æ—Ä–æ—Ç–∫–∏–µ_–æ—Ç–∑—ã–≤—ã sr
            JOIN auto_reviews.–º–æ–¥–µ–ª–∏ m ON sr.–º–æ–¥–µ–ª—å_—ñ–¥ = m.—ñ–¥
            JOIN auto_reviews.–±—Ä–µ–Ω–¥—ã b ON m.—ñ–¥_–±—Ä–µ–Ω–¥–∞ = b.—ñ–¥
            ORDER BY sr.–¥–∞—Ç–∞_–ø—É–±–ª–∏–∫–∞—Ü–∏–∏ DESC NULLS LAST
        """)
        
        for review in short_reviews:
            print(f"  ID {review['—ñ–¥']:2}: {review['–±—Ä–µ–Ω–¥']} {review['–º–æ–¥–µ–ª—å']}")
            print(f"        {review['–≥–æ–¥_–∞–≤—Ç–æ–º–æ–±–∏–ª—è'] or '?'} –≥–æ–¥, {review['–æ–±—ä–µ–º_–¥–≤–∏–≥–∞—Ç–µ–ª—è'] or '?'}–ª, {review['—Ç–∏–ø_—Ç–æ–ø–ª–∏–≤–∞'] or '?'}")
            print(f"        –ì–æ—Ä–æ–¥: {review['–≥–æ—Ä–æ–¥_–∞–≤—Ç–æ—Ä–∞'] or '?'}")
            print(f"        –ü–ª—é—Å—ã: {review['–ø–ª—é—Å—ã_–∫–æ—Ä–æ—Ç–∫–∏–µ'] or '–ù–µ —É–∫–∞–∑–∞–Ω—ã'}...")
            print(f"        –î–∞—Ç–∞: {review['–¥–∞—Ç–∞_–ø—É–±–ª–∏–∫–∞—Ü–∏–∏'] or '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}")
            print()
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ—Å—Å–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
        print("\nüîÑ –°–ï–°–°–ò–ò –ü–ê–†–°–ò–ù–ì–ê:")
        print("-" * 40)
        sessions = await conn.fetch("""
            SELECT —ñ–¥, —Ç–∏–ø_–ø–∞—Ä—Å–∏–Ω–≥–∞, —Å—Ç–∞—Ç—É—Å, –Ω–∞—á–∞–ª–æ_—Å–µ—Å—Å–∏–∏, –∫–æ–Ω–µ—Ü_—Å–µ—Å—Å–∏–∏, 
                   –≤—Å–µ–≥–æ_–Ω–∞–π–¥–µ–Ω–æ, —É—Å–ø–µ—à–Ω–æ_—Å–ø–∞—Ä—Å–µ–Ω–æ, –æ—à–∏–±–æ–∫
            FROM auto_reviews.—Å–µ—Å—Å–∏–∏_–ø–∞—Ä—Å–∏–Ω–≥–∞
            ORDER BY –Ω–∞—á–∞–ª–æ_—Å–µ—Å—Å–∏–∏ DESC
        """)
        
        for session in sessions:
            print(f"  ID {session['—ñ–¥']:2}: {session['—Ç–∏–ø_–ø–∞—Ä—Å–∏–Ω–≥–∞']:15} | –°—Ç–∞—Ç—É—Å: {session['—Å—Ç–∞—Ç—É—Å']:10}")
            print(f"        –ü–µ—Ä–∏–æ–¥: {session['–Ω–∞—á–∞–ª–æ_—Å–µ—Å—Å–∏–∏']} - {session['–∫–æ–Ω–µ—Ü_—Å–µ—Å—Å–∏–∏'] or '–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ'}")
            print(f"        –ù–∞–π–¥–µ–Ω–æ: {session['–≤—Å–µ–≥–æ_–Ω–∞–π–¥–µ–Ω–æ'] or 0}, –°–ø–∞—Ä—Å–µ–Ω–æ: {session['—É—Å–ø–µ—à–Ω–æ_—Å–ø–∞—Ä—Å–µ–Ω–æ'] or 0}, –û—à–∏–±–æ–∫: {session['–æ—à–∏–±–æ–∫'] or 0}")
            print()
        
        await conn.close()
        print("‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–≤–µ—Ä—à–µ–Ω")
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")

if __name__ == "__main__":
    asyncio.run(show_detailed_data())
